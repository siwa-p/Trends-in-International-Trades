{{ config(
    materialized='table',
    on_schema_change = 'ignore',
    format='iceberg',
    schema='silver',
    partition_by=['bucket(32, CTY_NAME)', 'EXPORT_YEAR']
) }}
select 
    CASE WHEN NULLIF(CTY_CODE, '-') IS NOT NULL THEN CAST(CTY_CODE AS INT) ELSE NULL END AS CTY_CODE,
    CTY_NAME,
    CASE WHEN NULLIF(DISTRICT, '-') IS NOT NULL THEN CAST(DISTRICT AS INT) ELSE NULL END AS DISTRICT,
    DIST_NAME,
    CAST(ALL_VAL_YR AS DOUBLE) AS ALL_VAL_YR,
    CAST(AIR_VAL_YR AS DOUBLE) AS AIR_VAL_YR,
    CAST(AIR_WGT_YR AS DOUBLE) AS AIR_WGT_YR,
    CAST(E_COMMODITY AS INT) AS E_COMMODITY,
    E_COMMODITY_SDESC,
    CAST(ALL_VAL_MO AS DOUBLE) AS ALL_VAL_MO,
    CAST(AIR_VAL_MO AS DOUBLE) AS AIR_VAL_MO,
    CAST(AIR_WGT_MO AS DOUBLE) AS AIR_WGT_MO,
    SUMMARY_LVL,
    COMM_LVL,
    CAST("YEAR" AS INT) AS EXPORT_YEAR,
    CAST("MONTH" AS INT) AS EXPORT_MONTH,
    CC_MO,
    CC_YR,
    CAST(CNT_VAL_MO AS DOUBLE) AS CNT_VAL_MO,
    CAST(CNT_VAL_YR AS DOUBLE) AS CNT_VAL_YR,
    CAST(CNT_WGT_MO AS DOUBLE) AS CNT_WGT_MO,
    CAST(CNT_WGT_YR AS DOUBLE) AS CNT_WGT_YR,
    LAST_UPDATE,
    CAST(QTY_1_MO AS DOUBLE) AS QTY_1_MO,
    QTY_1_MO_FLAG,
    CAST(QTY_1_YR AS DOUBLE) AS QTY_1_YR,
    QTY_1_YR_FLAG,
    CAST(QTY_2_MO AS DOUBLE) AS QTY_2_MO,
    QTY_2_MO_FLAG,
    CAST(QTY_2_YR AS DOUBLE) AS QTY_2_YR,
    QTY_2_YR_FLAG,
    UNIT_QY1,
    UNIT_QY2,
    CAST(VES_VAL_MO AS DOUBLE) AS VES_VAL_MO,
    CAST(VES_VAL_YR AS DOUBLE) AS VES_VAL_YR,
    CAST(VES_WGT_MO AS DOUBLE) AS VES_WGT_MO,
    CAST(VES_WGT_YR AS DOUBLE) AS VES_WGT_YR
from "wits-data".export_hs